name: ğŸš€ Deploy Service to AWS Lambda

# Se ejecuta en cada push a la rama 'main'
on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: Deploy to Production
    runs-on: ubuntu-latest
    environment: production  # opcional, Ãºtil si usas GitHub Environments

    env:
      AWS_REGION: us-west-1  # AsegÃºrate de que coincide con tu serverless.yml
      AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
      AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}

    steps:
      # 1ï¸âƒ£ Checkout del repositorio
      - name: ğŸ“¦ Checkout repository
        uses: actions/checkout@v4

      # 2ï¸âƒ£ Instalar Node.js
      - name: âš™ï¸ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'
          cache: 'npm'

      # 3ï¸âƒ£ Instalar dependencias
      - name: ğŸ“¥ Install dependencies
        run: npm ci

      # 4ï¸âƒ£ Instalar Serverless Framework globalmente
      - name: ğŸ§° Install Serverless Framework
        run: npm install -g serverless

      # 5ï¸âƒ£ Desplegar el servicio a AWS Lambda
      - name: ğŸš€ Deploy Serverless Service
        run: |
          echo "Starting deployment to production..."
          npx serverless deploy --stage production --verbose



          echo "Starting deployment to production..."
          npx serverless deploy --stage production --verbose
