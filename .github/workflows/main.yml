name: üöÄ Deploy Service to AWS Lambda

# Se ejecuta en cada push a la rama 'main'
on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: Deploy to Production
    runs-on: ubuntu-latest
    environment: production  # opcional, √∫til si usas GitHub Environments

    env:
      AWS_REGION: us-west-1  # Aseg√∫rate de que coincide con tu serverless.yml
      AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
      AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}

    steps:
      # 1Ô∏è‚É£ Checkout del repositorio
      - name: üì¶ Checkout repository
        uses: actions/checkout@v4

      # 2Ô∏è‚É£ Instalar Node.js
      - name: ‚öôÔ∏è Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'
          cache: 'npm'
      # 3Ô∏è‚É£ Instalar dependencias
      - name: üì• Install dependencies
        run: npm ci
      # 4Ô∏è‚É£ Instalar Serverless Framework globalmente
      - name: üß∞ Install Serverless Framework
        run: npm install -g serverless
      # 5Ô∏è‚É£ Desplegar el servicio a AWS Lambda
      - name: üöÄ Deploy Serverless Service
        run: npx serverless deploy --stage production --verbose
        env:
          # Aseg√∫rese de que sus credenciales de AWS est√©n configuradas aqu√≠ 
          # o a nivel de 'job' (como se hizo en el deploy.yml de ejemplo).
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
